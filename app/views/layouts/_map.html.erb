<form class="row" role="search" id="places_form">
        <div class="form-group col-md-12">
          <input type="text" id="autocomplete" class="form-control" placeholder="Search">
        </div>
      </form>

<div id="map" style='width: 800px; height: 400px;'></div>

<script>
// Note: This example requires that you consent to location sharing when
// prompted by your browser. If you see the error "The Geolocation service
// failed.", it means you probably did not give permission for the browser to
// locate you.

  function initMap() {
    var pos;
    var mapOptions = {
      center: pos,
      zoom: 15,
      styles: [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.airport","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.airport","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.bus","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.bus","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.rail","elementType":"all","stylers":[{"visibility":"on"}]},{"featureType":"transit.station.rail","elementType":"geometry","stylers":[{"visibility":"on"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#6e769e"},{"visibility":"on"}]}]
    };

    var map = new google.maps.Map(document.getElementById('map'), mapOptions);

    //pulling in assignee and todo coords from database
    var coords = <%= @coords_array.to_json.html_safe %>
    console.log(coords);
    
      
    var infoWindow = new google.maps.InfoWindow({map: map});

    for (var i = 0; i < coords.length; i++) {
        var data = coords[i];
        var myLatlng = new google.maps.LatLng(data.lat, data.lng);
        var icon_color;

           if (data.what == "assignee") {
               icon_color = "assets/images/marc_pic30.JPG"
            } else {
               icon_color = 'https://maps.google.com/mapfiles/ms/icons/green-dot.png' 
            };            

        var marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            title: data.name,
            icon: icon_color
        });
          
        //Attach click event to the marker.
        (function (marker, data) {
            google.maps.event.addListener(marker, "click", function (e) {
                //Wrap the content inside an HTML DIV in order to set height and width of InfoWindow.
                infoWindow.setContent("<div style = 'width:200px;min-height:40px;color:black'>" + data.name + "</div>");
                infoWindow.open(map, marker);
            });
        })(marker, data);
      }

    // Try HTML5 geolocation.
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };

        infoWindow.setPosition(pos);
        infoWindow.setContent("<div style = 'width:75px;min-height:10px;color:black'>You are Here</div>");
        map.setCenter(pos);
      }, function() {
        handleLocationError(true, infoWindow, map.getCenter());
      });
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, infoWindow, map.getCenter());
    }

    console.log(pos);
  } //end of initMap function

  function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(browserHasGeolocation ?
                          'Error: The Geolocation service failed.' :
                          'Error: Your browser doesn\'t support geolocation.');
  }


// $("input").geocomplete();

// // Trigger geocoding request.
// $("button.find").click(function(){
//   $("input").trigger("geocode");
//   console.log(this)
// });

// Run the initialize function when the window has finished loading.
// google.maps.event.addDomListener(window, 'load', initMap);



</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBMxa7ucqwX08z6wLjiuAj_YdCtTnXjWYY&signed_in=true&callback=initMap&libraries=places"
  async defer>
</script>